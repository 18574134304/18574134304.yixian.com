(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e29a9892"],{"00df":function(e,t,s){"use strict";s("9e53")},"00e4":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.dialogVisible?s("div",{staticClass:"overlay-p"},[s("div",{staticClass:"dialog"},[s("div",{staticClass:"title",on:{click:e.closeDialog}},[e._v("×")]),s("div",{staticClass:"msg-box"},[s("div",{staticClass:"msg"},[e._v("请输入支付密码")]),s("div",{staticClass:"price"},[e._v("付款"+e._s(e.order_money)+"元")]),e.err_flag?s("div",{staticClass:"err-msg",class:{animition:!0}},[e._v(" "+e._s("p_error"===e.err_flag?"支付密码不正确":"余额不足")+" ")]):e._e()]),s("van-password-input",{attrs:{value:e.password_value,focused:e.showKeyboard,length:6},on:{focus:function(t){e.showKeyboard=!0}}}),s("loading",{directives:[{name:"show",rawName:"v-show",value:e.payLoading,expression:"payLoading"}],attrs:{loadingType:4,paySuccess:e.paySuccess}})],1),s("van-number-keyboard",{attrs:{maxlength:"6","hide-on-click-outside":!1,show:e.showKeyboard,"safe-area-inset-bottom":!1},on:{blur:function(t){e.showKeyboard=!0}},model:{value:e.password_value,callback:function(t){e.password_value=t},expression:"password_value"}})],1):e._e()},r=[],i=(s("d3b7"),s("3ca3"),s("ddb0"),s("2b3d"),s("96cf"),s("1da1")),o=s("bf93"),n={components:{Loading:o["a"]},props:{dialogVisible:{type:Boolean,default:!1},order_id:{type:String},order_money:{default:0}},data:function(){return{password_value:"",showKeyboard:!0,paySuccess:!1,payLoading:!1,err_flag:null}},methods:{closeDialog:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.err_flag=null,this.password_value="",this.paySuccess=!1,this.$emit("changeDialog",t)},validPassword:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var s,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.err_flag=null,s=new URLSearchParams,s.append("orderId",e.order_id),s.append("userToken",e.$store.state.token),s.append("password",e.password_value),t.next=7,e.$http.post("/user/postPayOrderServlet",s);case 7:a=t.sent,r=a.data,"000000"===r.messageStatus?(setTimeout((function(){e.paySuccess=!0}),800),setTimeout((function(){e.payLoading=!1,e.closeDialog("_",!0)}),2300)):setTimeout((function(){e.paySuccess=!1,e.payLoading=!1,e.password_value="","123456"===r.messageStatus?e.err_flag="p_error":"654321"===r.messageStatus?e.err_flag="price_not":e.$toast(r.error)}),800);case 10:case"end":return t.stop()}}),t)})))()}},watch:{password_value:function(e){6===e.length&&(this.payLoading=!0,this.validPassword())}}},d=n,c=(s("b72a"),s("2877")),l=Object(c["a"])(d,a,r,!1,null,null,null);t["a"]=l.exports},"4f5e":function(e,t,s){},5257:function(e,t,s){},"76e0":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"pay-order"},[s("nav-bar",{attrs:{title:"提交订单",link:"/index",location_search_id:e.location_search}}),s("div",{staticClass:"p-header-bg"}),s("div",{staticClass:"pay-content"},[e.takeway?s("div",{staticClass:"checkAddress",on:{click:function(t){e.show=!0}}},[s("a",{attrs:{href:"javascript:void(0);"}},[e.checkAddress?[s("div",{staticClass:"check-info"},[s("van-icon",{attrs:{name:"location-o"}}),s("div",{staticClass:"info"},[s("p",{staticClass:"address"},[e._v(" "+e._s(e.checkAddress.address+" "+e.checkAddress.addressMessage)+" ")]),s("p",{staticClass:"name"},[e._v(" "+e._s(e.checkAddress.name+" "+e.checkAddress.tel)+" ")])])],1),s("van-icon",{staticClass:"arrow-right",attrs:{name:"arrow"}})]:s("van-cell",{attrs:{title:"请选择收货地址",icon:"location-o","is-link":""}})],2)]):e._e(),s("div",{staticClass:"od-content"},[s("div",{staticClass:"order-food"},[s("div",{staticClass:"shop-info"},[s("div",{staticClass:"od-shop"},[e._v(" "+e._s(e.order_info.shopName?e.order_info.shopName:"三华科技")+" ")]),s("span",[e._v("已点菜品")])]),s("div",{staticClass:"content-box"},[s("div",{class:{"content-down":!e.flag,"content-up":e.flag}},[s("foodItem",{attrs:{food:e.$store.state.foodList,setStyle:"o-food-item"}})],1),e.foodList.length>3?s("div",{staticClass:"toggle",on:{click:function(t){e.flag=!e.flag}}},[s("span",{directives:[{name:"show",rawName:"v-show",value:!e.flag,expression:"!flag"}]},[e._v("展示更多"),s("van-icon",{attrs:{name:"arrow-down"}})],1),s("span",{directives:[{name:"show",rawName:"v-show",value:e.flag,expression:"flag"}]},[e._v("点击收起"),s("van-icon",{attrs:{name:"arrow-up"}})],1)]):e._e()]),s("div",{staticClass:"od-price"},[e._v(" 共 "+e._s(e.foodLength)+" 份,小计: "),s("span",[e._v(e._s("￥"+e.totalPrice))])])])]),s("div",{staticClass:"pay-methods"},[e._m(0),s("div",{staticClass:"pay"},[s("van-radio-group",{model:{value:e.openMethod,callback:function(t){e.openMethod=t},expression:"openMethod"}},["WeChat"===e.openMethod?s("div",{staticClass:"pay-item"},[s("div",{staticClass:"p-method"},[s("span",{staticClass:"pay-icon"},[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-weixinzhifu"}})])]),s("span",{staticClass:"msg"},[e._v("微信支付")])]),s("div",{staticClass:"check"},[s("van-radio",{staticClass:"pay-check",attrs:{name:"WeChat"}})],1)]):s("div",{staticClass:"pay-item"},[s("div",{staticClass:"p-method"},[s("span",{staticClass:"pay-icon"},[s("svg",{staticClass:"icon Alipay",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-zhifubao"}})])]),s("span",{staticClass:"msg"},[e._v("支付宝支付")])]),s("div",{staticClass:"check"},[s("van-radio",{staticClass:"pay-check",attrs:{name:"AliPay"}})],1)])])],1)]),s("router-link",{staticClass:"pay-notes clearfix",attrs:{to:{name:"note",params:{data:e.noteStr}}}},[s("span",{staticClass:"note-msg fl"},[e._v("订单备注")]),s("div",{staticClass:"note-box fr"},[s("span",{staticClass:"note-router van-ellipsis"},[e._v(e._s(e.noteStr?e.noteStr:"点击填写备注"))]),s("van-icon",{staticClass:"note-icon",attrs:{name:"arrow"}})],1)])],1),s("div",{staticClass:"pay-fot clearfix"},[s("div",{staticClass:"p-left fl"},[s("div",{staticClass:"p-box"},[s("span",{staticClass:"p-msg"},[e._v("共计: ")]),s("span",{staticClass:"p-price"},[e._v(e._s("￥"+e.totalPrice))])])]),s("div",{staticClass:"p-sub fr",on:{click:e.pay}},[e._v("去支付")])]),e.takeway?s("van-action-sheet",{staticClass:"checkAddress-popup",attrs:{title:"选择收货地址"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[s("div",{staticStyle:{position:"reletive"}},[s("div",{staticClass:"content"},[e.address_list.length?[s("p",{staticClass:"title"},[e._v("可选地址")]),s("div",{staticClass:"address-list"},[s("van-radio-group",{attrs:{"checked-color":"#2cb5a5"},on:{change:e.change},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._l(e.address_list,(function(t,a){return[s("div",{key:a,staticClass:"item"},[s("van-radio",{attrs:{name:a}},[s("div",{staticClass:"info"},[s("p",{staticClass:"address"},[e._v(" "+e._s(t.address+" "+t.addressMessage)+" ")]),s("p",[s("span",[e._v(e._s(t.name+" "+t.tel))])])])])],1)]}))],2)],1)]:e._e(),e.address_list.length||e.not_address_list.length?e._e():s("h2",{staticStyle:{"font-size":"20px","margin-top":"25%","text-align":"center"}},[e._v(" 还没有地址嗷~ ")]),e.not_address_list.length?[s("p",{staticClass:"title not"},[e._v("以下地址超出配送范围")]),s("div",{staticClass:"address-list gray"},e._l(e.not_address_list,(function(t){return s("div",{key:t.id,staticClass:"item"},[s("div",{staticClass:"info"},[s("p",{staticClass:"address"},[e._v(" "+e._s(t.address+" "+t.addressMessage)+" ")]),s("p",[s("span",[e._v(e._s(t.name+" "+t.tel))])])])])})),0)]:e._e()],2),s("a",{staticClass:"add-address",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$router.push({path:"/addaddress",query:{type:"pay"}})}}},[e._v("新增地址")])])]):e._e(),s("pay-dialog",{attrs:{dialogVisible:e.dialogVisible,order_id:e.order_id,order_money:e.totalPrice},on:{changeDialog:e.changeDialog}})],1)},r=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"header"},[s("p",[e._v("支付方式")]),s("p",[e._v("在线支付")])])}],i=(s("99af"),s("4de4"),s("c740"),s("4160"),s("a434"),s("b0c0"),s("d3b7"),s("ac1f"),s("3ca3"),s("5319"),s("159b"),s("ddb0"),s("2b3d"),s("96cf"),s("1da1")),o=s("5530"),n=s("d968"),d=s("00e4"),c=s("92fe"),l=s("2f62"),p={components:{NavBar:n["a"],foodItem:c["a"],PayDialog:d["a"]},data:function(){return{radio:"1",show:!1,flag:!1,noteStr:"",order_info:{shopId:"",shopName:"",orderTime:(new Date).getTime(),orderType:"forHere",tableNumber:"测试2号桌",userName:"",userPhone:"",orderPice:"",orderMessage:"",userAddress:"",orderUserId:""},address_list:[],not_address_list:[],checkAddress:null,dialogVisible:!1,order_id:"",money:0,address_flag:!0}},computed:Object(o["a"])(Object(o["a"])({},Object(l["d"])(["foodList","openMethod","totalPrice","shopName","shopId","takeway","location_search"])),Object(l["b"])(["foodLength"])),mounted:function(){if(this.onpopstate(),!this.foodList.length){var e=JSON.parse(localStorage.getItem("cart"));e&&this.$store.commit("setFoodList",e)}this.$route.params.data&&(this.noteStr=this.$route.params.data)},created:function(){var e=this;this.takeway&&(this.order_info.orderType="takeOut"),this.order_info.orderUserId=this.$store.state.token,this.order_info.shopId=this.shopId;var t=JSON.parse(localStorage.getItem("param"));t&&t.pay_picker_poi&&(this.checkAddress=t.pay_picker_poi);var s=JSON.parse(localStorage.getItem("Allcart")),a=s.findIndex((function(t){return t.id===e.shopId}));this.order_info.shopName=s[a].shopName},methods:{getOrder:function(e,t){var s=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,i,o,n,d,c,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if("confirm"!==e){a.next=17;break}for(d in r=[],o=s.order_info,s.foodList.forEach((function(e){var t=e.foodId,s=e.foodNumber;i="".concat(t,":").concat(s),r.push(i)})),o.orderMessage=JSON.stringify(r),o.orderPice=s.totalPrice,n=new URLSearchParams,n.append("payType","wechat"),n.append("orderRemarks",s.noteStr),o)n.append(d,o[d]);return a.next=12,s.$http.post("/user/postAddOrder",n);case 12:c=a.sent,l=c.data,l&&setTimeout((function(){if(t(),"000000"===l.messageStatus){s.money=l.money,s.order_id=l.orderId;var e=JSON.parse(localStorage.getItem("Allcart")),a=e.findIndex((function(e){return e.id===s.shopId}));e.splice(a,1),localStorage.removeItem("cart"),s.dialogVisible=!0,s.takeway?s.showKeyboard=!0:(s.$toast("下单成功"),s.$router.replace({path:"/index",query:{shop_id:s.$store.state.shopId}}));var r={list:e,type:1};s.$store.commit("set_All_foodList",r)}else"666666"===l.messageStatus?(localStorage.removeItem("token"),localStorage.removeItem("user"),store.commit("set_User_info"),Vue.prototype.$toast("登录凭证已过期，请重新登陆"),router.replace("/login")):s.$toast("失败")}),1e3),a.next=18;break;case 17:t();case 18:case"end":return a.stop()}}),a)})))()},getAddress:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var s,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.address_flag=!1,s=new URLSearchParams,s.append("shopId",e.shopId),s.append("userToken",e.$store.state.token),t.next=6,e.$http.post("/user/postSelectAddressByCouldSend",s);case 6:a=t.sent,r=a.data,console.log(r),"000000"===r.messageStatus&&r.listArray.filter((function(t){return"Y"===t.isCouldSend?e.address_list.push(t):e.not_address_list.push(t)}));case 10:case"end":return t.stop()}}),t)})))()},change:function(e){this.checkAddress=this.address_list[e],this.show=!1,console.log(this.checkAddress);var t=JSON.parse(localStorage.getItem("param"));t&&(t.pay_picker_poi||(t.pay_picker_poi={}),t.pay_picker_poi.name=this.checkAddress.name,t.pay_picker_poi.tel=this.checkAddress.tel,t.pay_picker_poi.address=this.checkAddress.address,t.pay_picker_poi.addressMessage=this.checkAddress.addressMessage),localStorage.setItem("param",JSON.stringify(t))},pay:function(){if(this.takeway&&!this.checkAddress)return this.$toast("请选择收货地址");this.takeway&&(this.order_info.userName=this.checkAddress.name,this.order_info.userPhone=this.checkAddress.tel,this.order_info.userAddress=this.checkAddress.address+" "+this.checkAddress.addressMessage),this.$confirm({title:"提示",message:"确定提交订单吗?",beforeClose:this.getOrder})},changeDialog:function(){this.dialogVisible=!1,this.$router.replace({path:"/detail",query:{o_id:this.order_id}})},onpopstate:function(){window.addEventListener("popstate",this.back,!1)},back:function(){this.$router.replace("/")}},destroyed:function(){window.removeEventListener("popstate",this.back,!1)},watch:{show:function(e){e&&this.address_flag&&this.getAddress()}}},h=p,u=(s("f42c"),s("2877")),f=Object(u["a"])(h,a,r,!1,null,"3d82fcb2",null);t["default"]=f.exports},"857a":function(e,t,s){var a=s("1d80"),r=/"/g;e.exports=function(e,t,s,i){var o=String(a(e)),n="<"+t;return""!==s&&(n+=" "+s+'="'+String(i).replace(r,"&quot;")+'"'),n+">"+o+"</"+t+">"}},9911:function(e,t,s){"use strict";var a=s("23e7"),r=s("857a"),i=s("af03");a({target:"String",proto:!0,forced:i("link")},{link:function(e){return r(this,"a","href",e)}})},"9e53":function(e,t,s){},a434:function(e,t,s){"use strict";var a=s("23e7"),r=s("23cb"),i=s("a691"),o=s("50c4"),n=s("7b0b"),d=s("65f0"),c=s("8418"),l=s("1dde"),p=s("ae40"),h=l("splice"),u=p("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,v=Math.min,_=9007199254740991,g="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!h||!u},{splice:function(e,t){var s,a,l,p,h,u,m=n(this),y=o(m.length),k=r(e,y),w=arguments.length;if(0===w?s=a=0:1===w?(s=0,a=y-k):(s=w-2,a=v(f(i(t),0),y-k)),y+s-a>_)throw TypeError(g);for(l=d(m,a),p=0;p<a;p++)h=k+p,h in m&&c(l,p,m[h]);if(l.length=a,s<a){for(p=k;p<y-a;p++)h=p+a,u=p+s,h in m?m[u]=m[h]:delete m[u];for(p=y;p>y-a+s;p--)delete m[p-1]}else if(s>a)for(p=y-a;p>k;p--)h=p+a-1,u=p+s-1,h in m?m[u]=m[h]:delete m[u];for(p=0;p<s;p++)m[p+k]=arguments[p+2];return m.length=y-a+s,l}})},af03:function(e,t,s){var a=s("d039");e.exports=function(e){return a((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},b72a:function(e,t,s){"use strict";s("4f5e")},c740:function(e,t,s){"use strict";var a=s("23e7"),r=s("b727").findIndex,i=s("44d2"),o=s("ae40"),n="findIndex",d=!0,c=o(n);n in[]&&Array(1)[n]((function(){d=!1})),a({target:"Array",proto:!0,forced:d||!c},{findIndex:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),i(n)},d968:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"nav"},[s("div",{staticClass:"b"},[s("van-icon",{staticClass:"nav-arrow-left",attrs:{name:"arrow-left"},on:{click:e.navigator}}),s("div",{staticClass:"nav-title"},[e._v(e._s(e.title))])],1)])},r=[],i=(s("ac1f"),s("5319"),s("9911"),{props:["title","link","location_search_id"],methods:{navigator:function(){"/"===this.link?this.$router.go(-1):"/index"===this.link?this.location_search_id?this.$router.replace({path:"/index"+this.location_search_id}):this.$router.replace({path:"/index",query:{shop_id:this.$store.state.shopId}}):"/mine"===this.link?this.$router.replace(this.link):this.$router.go(-1)}}}),o=i,n=(s("00df"),s("2877")),d=Object(n["a"])(o,a,r,!1,null,"93c629b4",null);t["a"]=d.exports},f42c:function(e,t,s){"use strict";s("5257")}}]);